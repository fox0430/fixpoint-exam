import unittest, strutils, times, options
include src/inspectlog

const log = """
20201019133124,10.20.30.1/16,1
20201019133125,10.20.30.2/16,1
20201019133134,192.168.1.1/24,50
20201019133135,192.168.1.2/24,50
20201019133224,10.20.30.1/16,50
20201019133225,10.20.30.2/16,1
20201019133234,192.168.1.1/24,1
20201019133235,192.168.1.2/24,1
20201019133324,10.20.30.1/16,50
20201019133325,10.20.30.2/16,50
20201019133326,10.20.30.2/16,50
20201019133327,10.20.30.2/16,-
20201019133328,10.20.30.2/16,-
20201019133329,10.20.30.2/16,-
20201019133330,10.20.30.2/16,50
20201019133331,10.20.30.2/16,50
20201019133332,10.20.30.2/16,50
"""

suite "設問 3":
  test "3回過負荷状態になる場合":
    let
      logList = initLogInfoList(log.splitLines)
      loadTimeSetting = HeavilyLoadTimeSetting(Count: 3, Time: 50)
      heavilyLoadTimes = getHeavilyLoadTimes(logList, loadTimeSetting)

    check heavilyLoadTimes.len == 3
